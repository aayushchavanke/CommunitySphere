<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Technical Club - CommunitySphere</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="club-style.css">
</head>

<body>
    <!-- ===== HEADER ===== -->
    <header>
        <nav class="navbar">
            <div class="logo-section">
                <div class="logo">CC</div>
                <h1 class="college-name">CommunitySphere</h1>
            </div>
            <div class="nav-right">
                <a href="index.html" class="nav-link">Home</a>
                <a href="technical.html" class="nav-link active">Technical</a>
                <a href="cultural.html" class="nav-link">Cultural</a>
                <a href="sports.html" class="nav-link">Sports</a>
                <button class="theme-toggle" onclick="toggleTheme()">üåô Toggle Theme</button>
                <div class="auth-buttons">
                    <button class="btn btn-login" onclick="openModal('loginModal')">Login</button>
                    <button class="btn btn-signup" onclick="openModal('signupModal')">Sign Up</button>
                </div>
            </div>
        </nav>
    </header>

    <!-- ===== LOGIN MODAL ===== -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('loginModal')">&times;</span>
            <h2 class="form-title">Welcome Back!</h2>
            <form id="loginForm" onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label for="loginEmail">College Email</label>
                    <input type="email" id="loginEmail" placeholder="your.prn@gst.sies.edu.in" required>
                    <span class="error-message" id="loginEmailError"></span>
                </div>
                <div class="form-group">
                    <label for="loginPassword">Password</label>
                    <input type="password" id="loginPassword" placeholder="Enter your password" required>
                </div>
                <button type="submit" class="btn btn-submit">Login</button>
            </form>
        </div>
    </div>

    <!-- ===== SIGNUP MODAL ===== -->
    <div id="signupModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('signupModal')">&times;</span>
            <h2 class="form-title">Join Our Community!</h2>
            <form id="signupForm" onsubmit="handleSignup(event)">
                <div class="form-group">
                    <label for="signupName">Full Name</label>
                    <input type="text" id="signupName" placeholder="Enter your full name" required>
                </div>
                <div class="form-group">
                    <label for="signupPRN">College PRN</label>
                    <input type="text" id="signupPRN" placeholder="Enter your PRN" required>
                    <span class="error-message" id="prnError"></span>
                </div>
                <div class="form-group">
                    <label for="signupEmail">College Email</label>
                    <input type="email" id="signupEmail" placeholder="your.prn@gst.sies.edu.in" required>
                    <span class="error-message" id="emailError"></span>
                </div>
                <div class="form-group">
                    <label for="signupPassword">Password</label>
                    <input type="password" id="signupPassword" placeholder="Create a password" required>
                </div>
                <button type="submit" class="btn btn-submit">Sign Up</button>
            </form>
        </div>
    </div>

    <!-- ===== IMMERSIVE CLUB HEADER ===== -->
    <section class="club-header technical-header">
        <div class="club-header-particles"></div>
        <div class="club-header-content">
            <div class="club-header-text">
                <div class="club-icon">üíª</div>
                <h1 class="club-title">Technical Club</h1>
                <p class="club-subtitle">Build cutting-edge projects, master modern technologies, and innovate with a community of passionate developers and tech enthusiasts.</p>
            </div>
            <div class="club-header-visual">
                <img src="https://images.unsplash.com/photo-1555066931-4365d14bab8c?w=800&h=800&fit=crop&q=80" alt="Coding workspace" class="club-feature-image">
            </div>
        </div>
    </section>

    <!-- ===== MAIN CONTENT ===== -->
    <main class="club-main">
        <div class="club-container-simple">
            <!-- About Section -->
            <aside class="club-sidebar">
                <div class="info-box">
                    <h3>About Technical Club</h3>
                    <p>Master coding, robotics, AI, web development, and design. Join hackathons, build real-world projects, and explore the latest in technology.</p>
                </div>
            </aside>

            <!-- Post Feed -->
            <section class="club-feed">
                <!-- Auth Gate -->
                <div id="technical-auth-gate" class="auth-gate">
                    <div class="auth-gate-icon">üîí</div>
                    <h3 class="auth-gate-title">Join the Conversation</h3>
                    <p class="auth-gate-message">Please login or sign up to access the Technical Club community, view posts, and share your ideas.</p>
                    <div class="auth-gate-buttons">
                        <button onclick="openModal('loginModal')" class="btn-auth-gate btn-auth-login">Login</button>
                        <button onclick="openModal('signupModal')" class="btn-auth-gate btn-auth-signup">Sign Up</button>
                    </div>
                </div>

                <!-- Create Post Box -->
                <div id="technical-create-post" class="create-post-box" style="display: none;">
                    <h3>‚úèÔ∏è Share Your Thoughts</h3>
                    <div class="post-input-container">
                        <textarea id="technical-post-content" placeholder="What's on your mind? Share projects, ideas, questions..." rows="4"></textarea>
                        <button onclick="createTechnicalPost()" class="btn-post">
                            <span class="btn-post-icon">üì§</span>
                            Post
                        </button>
                    </div>
                </div>

                <!-- Posts Feed -->
                <div class="posts-container" id="technical-posts">
                    <!-- Posts will be dynamically added here -->
                </div>
            </section>
        </div>
    </main>

    <!-- ===== FOOTER ===== -->
    <footer>
        <p>Made with ‚ù§Ô∏è by <span class="footer-gradient">Parth, Aayush, and Lokesh</span></p>
        <p style="margin-top: 0.8rem; font-size: 0.9rem; opacity: 0.7;">¬© 2024 CommunitySphere. All rights reserved.</p>
    </footer>

    <!-- Load main script.js first -->
    <script src="script.js"></script>

    <!-- Technical page specific script -->
    <script>
    console.log('Technical page script loading...');

    const TECH_API_URL = ' ';

    async function initTechnicalPage() {
        console.log('Initializing technical page...');
        
        setTimeout(async function() {
            console.log('Checking auth state:', window.isUserLoggedIn);
            
            if (window.isUserLoggedIn) {
                document.getElementById('technical-auth-gate').style.display = 'none';
                document.getElementById('technical-create-post').style.display = 'block';
                await loadTechnicalPosts();
            } else {
                document.getElementById('technical-auth-gate').style.display = 'block';
                document.getElementById('technical-create-post').style.display = 'none';
            }
        }, 500);
    }

    async function loadTechnicalPosts() {
        console.log('Loading posts...');
        try {
            const response = await fetch(TECH_API_URL + '/fetch_messages.php?club=technical', {
                credentials: 'include'
            });
            const data = await response.json();
            console.log('Posts data received:', data);
            
            if (data.success && data.posts) {
                displayTechnicalPosts(data.posts);
            }
        } catch (error) {
            console.error('Error loading posts:', error);
        }
    }

    function displayTechnicalPosts(posts) {
        const container = document.getElementById('technical-posts');
        container.innerHTML = '';
        
        if (posts.length === 0) {
            container.innerHTML = '<p style="text-align:center; padding:2rem; opacity:0.6;">No posts yet. Be the first to post!</p>';
            return;
        }
        
        posts.sort(function(a, b) {
            return new Date(b.created_at) - new Date(a.created_at);
        });
        
        posts.forEach(function(post) {
            const card = document.createElement('div');
            card.style.cssText = 'background:white; padding:1.5rem; margin:1rem 0; border-radius:12px; box-shadow:0 2px 12px rgba(0,0,0,0.1);';
            
            const username = post.username || 'Anonymous';
            const message = post.message || post.content || 'No message';
            const timestamp = formatTimestamp(post.created_at);
            const likes = post.likes || 0;
            const postId = post.id;
            
            const headerDiv = document.createElement('div');
            headerDiv.style.cssText = 'display:flex; align-items:center; margin-bottom:1rem;';
            headerDiv.innerHTML = '<div style="width:40px; height:40px; border-radius:50%; background:linear-gradient(135deg, #667eea 0%, #764ba2 100%); display:flex; align-items:center; justify-content:center; color:white; font-weight:bold; margin-right:1rem;">' + getInitials(username) + '</div>' +
                                '<div><div style="font-weight:600; color:#333;">' + username + '</div>' +
                                '<div style="font-size:0.85rem; color:#999;">' + timestamp + '</div></div>';
            
            const contentDiv = document.createElement('div');
            contentDiv.style.cssText = 'color:#555; margin-bottom:1rem; line-height:1.6; white-space:pre-wrap;';
            contentDiv.textContent = message;
            
            const actionsDiv = document.createElement('div');
            actionsDiv.style.cssText = 'display:flex; gap:1rem; padding-top:1rem; border-top:1px solid #eee;';
            
            const likeBtn = document.createElement('button');
            likeBtn.style.cssText = 'background:#4CAF50; color:white; border:none; padding:0.5rem 1.2rem; border-radius:6px; cursor:pointer; font-size:0.9rem; transition:all 0.3s;';
            likeBtn.innerHTML = 'üëç Like (' + likes + ')';
            likeBtn.onclick = function() { likePost(postId); };
            likeBtn.onmouseover = function() { this.style.background = '#45a049'; };
            likeBtn.onmouseout = function() { this.style.background = '#4CAF50'; };
            
            actionsDiv.appendChild(likeBtn);
            
            if (window.currentUser && post.username === window.currentUser.fullname) {
                const deleteBtn = document.createElement('button');
                deleteBtn.style.cssText = 'background:#f44336; color:white; border:none; padding:0.5rem 1.2rem; border-radius:6px; cursor:pointer; font-size:0.9rem; transition:all 0.3s;';
                deleteBtn.innerHTML = 'üóëÔ∏è Delete';
                deleteBtn.onclick = function() { deletePost(postId); };
                deleteBtn.onmouseover = function() { this.style.background = '#da190b'; };
                deleteBtn.onmouseout = function() { this.style.background = '#f44336'; };
                actionsDiv.appendChild(deleteBtn);
            }
            
            card.appendChild(headerDiv);
            card.appendChild(contentDiv);
            card.appendChild(actionsDiv);
            
            container.appendChild(card);
        });
    }

    function formatTimestamp(timestamp) {
        if (!timestamp) return 'Just now';
        
        const date = new Date(timestamp);
        const now = new Date();
        const diffMs = now - date;
        const diffMins = Math.floor(diffMs / 60000);
        const diffHours = Math.floor(diffMs / 3600000);
        const diffDays = Math.floor(diffMs / 86400000);
        
        if (diffMins < 1) return 'Just now';
        if (diffMins < 60) return diffMins + ' min' + (diffMins > 1 ? 's' : '') + ' ago';
        if (diffHours < 24) return diffHours + ' hour' + (diffHours > 1 ? 's' : '') + ' ago';
        if (diffDays < 7) return diffDays + ' day' + (diffDays > 1 ? 's' : '') + ' ago';
        
        return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
    }

    function getInitials(name) {
        if (!name) return '?';
        const parts = name.trim().split(' ');
        if (parts.length >= 2) {
            return (parts[0][0] + parts[parts.length - 1][0]).toUpperCase();
        }
        return name.substring(0, 2).toUpperCase();
    }

    async function createTechnicalPost() {
        console.log('Creating post...');
        
        if (!window.isUserLoggedIn) {
            alert('Please login first!');
            openModal('loginModal');
            return;
        }
        
        const textarea = document.getElementById('technical-post-content');
        const content = textarea.value.trim();
        
        if (!content) {
            alert('Please write something!');
            return;
        }
        
        try {
            const response = await fetch(TECH_API_URL + '/post_message.php', {
                method: 'POST',
                credentials: 'include',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    club: 'technical',
                    message: content
                })
            });
            
            const data = await response.json();
            console.log('Post response:', data);
            
            if (data.success) {
                textarea.value = '';
                alert('Post created successfully! üéâ');
                await loadTechnicalPosts();
            } else {
                alert('Error: ' + data.message);
            }
        } catch (error) {
            console.error('Post error:', error);
            alert('Failed to post: ' + error.message);
        }
    }

    async function likePost(postId) {
        try {
            const response = await fetch(TECH_API_URL + '/like_post.php', {
                method: 'POST',
                credentials: 'include',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    club: 'technical',
                    post_id: postId
                })
            });
            
            const data = await response.json();
            if (data.success) {
                await loadTechnicalPosts();
            }
        } catch (error) {
            console.error('Like error:', error);
        }
    }

    async function deletePost(postId) {
        if (!confirm('Are you sure you want to delete this post?')) return;
        
        try {
            const response = await fetch(TECH_API_URL + '/delete_post.php', {
                method: 'POST',
                credentials: 'include',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    club: 'technical',
                    post_id: postId
                })
            });
            
            const data = await response.json();
            if (data.success) {
                alert('Post deleted successfully');
                await loadTechnicalPosts();
            } else {
                alert('Failed to delete post');
            }
        } catch (error) {
            console.error('Delete error:', error);
        }
    }

    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initTechnicalPage);
    } else {
        initTechnicalPage();
    }
    </script>
</body>

</html>
